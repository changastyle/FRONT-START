<html><head>

      <meta charset="UTF-8 ">

      <!-- COLOR BARRA : -->
      <meta content="width=device-width, user-scalable=no" name="viewport">
      <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" name="viewport" />
      <meta name="theme-color" content="#E36B2C">

      <!-- FAVICON : -->
      <link rel="icon" href="http://eu.viewdevs.com.ar:9000/wizard/upload/favicon.png" />


      <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.16.0/umd/popper.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular.min.js"></script>
      <script src="https://ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-sanitize.js"></script>

      <!-- BS4: -->
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css">
      <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>

      <!-- FONT AWESOME: -->
      <script src="https://kit.fontawesome.com/01ed377a67.js" crossorigin="anonymous"></script>

      <!-- SUMMERNOTE: -->
      <link href="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote.css" rel="stylesheet">
      <script src="https://cdnjs.cloudflare.com/ajax/libs/summernote/0.8.12/summernote.js"></script>

      <!-- NG SANITIZE: -->
      <!-- ng-bind-html="myText" -->
      <script src="//ajax.googleapis.com/ajax/libs/angularjs/1.6.9/angular-sanitize.js"></script>

      <!-- FONTS: -->
      <link rel="preconnect" href="https://fonts.googleapis.com">
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
      <link href="https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;0,800;1,300;1,500;1,600;1,700;1,800&display=swap"
            rel="stylesheet">
      <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,400;0,500;1,400&family=Source+Sans+Pro&family=Ubuntu:ital,wght@0,300;0,400;1,300&display=swap"
            rel="stylesheet">
      <!-- <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@500&display=swap" rel="stylesheet"> -->
      <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@500;700&display=swap" rel="stylesheet">
      <!-- DE ACA SE PUEDE BORRAR: -->
      <!-- <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" rel="stylesheet"> -->
      <!-- <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.0.0/animate.min.css" rel="stylesheet" /> -->
      <!-- <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script> -->
      <!-- <script async defer src="https://apis.google.com/js/platform.js"></script> -->

</head>

<body ng-app="app" ng-controller="ctl" ng-init="init()" ng-cloak class="body sin-padding col-12">		<h3>Payments Front</h3>
		{{arrInvoices}}
		
		<br>
		ARR PRODUCTOS: {{arrProductos}}
		
		    <div class="cuadro-login col-12">
		    
		          <div class="col-12">
		                <input type="text" ng-model="email" class="form-control" placeholder="usuario@mail.com">
		          </div>
		          <div class="col-12 ">
		                <input type="password" ng-model="pass" class="form-control" placeholder="Clave..">
		          </div>
		          <div class="col-12 pt-3 pb-3">
		                <button class="btn btn-success col-12" ng-click="logearse()">
		                      Login
		                </button>
		                <button class="btn btn-warning col-12" ng-click="comprobarOperadorLogeado()">
		                      Comporobar Logeado
		                </button>
		          </div>
		    
		    
		          <div class="col-12">
		                <h3>Usuario Logeado:</h3>
		                <p>{{usrLogeado}}</p>
		                <h3>JWT:</h3>
		                <p>
		                      {{jwt}}
		                </p>
		          </div>
		    </div>
		    
		    <style>
		    
		    
		    </style>
		    
		
		<select class="form-control" ng-model="productoSelected"
		      ng-options="producto as producto.nombre for producto in arrProductos track by producto.nombre">
		</select>
		
		<style>
		</style>
</body>
<script>
      app = angular.module('app', ['ngSanitize']);

      // <input type="file" custom-on-change="changeUploadFile">
      //     $scope.changeUploadFile = function (event)
      //       {
      //             var files = event.target.files;
      //       };
      app.directive('customOnChange', function ()
      {
            return {
                  restrict: 'A',
                  link: function (scope, element, attrs)
                  {
                        var onChangeHandler = scope.$eval(attrs.customOnChange);
                        element.on('change', onChangeHandler);
                        element.on('$destroy', function ()
                        {
                              element.off();
                        });

                  }
            };
      });

      app.controller('ctl', function ($scope)
      {	
	      $scope.init = function ()
	      {
	            console.log("INIT");
	            $scope.getJWT();
	            $scope.comprobarOperadorLogeado();
	            $scope.findInvoices();
	            $scope.findProductos();
	      }
	
	      $scope.findInvoices = function ()
	      {
	            $scope.cargandoInvoices = false;
	            $.ajax(
	                  {
	                        url: $scope.urlWS + "invoices/find",
	                        headers:
	                        {
	                              "authorization": "Bearer " + $scope.token
	                        },
	                        data:
	                        {
	
	                        },
	                        beforeSend: function (xhr) 
	                        {
	                              $scope.cargandoInvoices = true;
	                        },
	                        success: function (resultado, textStatus, jqXHR) 
	                        {
	                              $scope.arrInvoices = resultado;
	                              $scope.cargandoInvoices = false;
	                              $scope.$evalAsync();
	                        }
	
	                  });
	      }
	      $scope.findProductos = function ()
	      {
	            $scope.cargandoProductos = false;
	            $.ajax(
	                  {
	                        url: $scope.urlWS + "producto/",
	                        headers:
	                        {
	                              "authorization": "Bearer " + $scope.token
	                        },
	                        data:
	                        {
	
	                        },
	                        beforeSend: function (xhr) 
	                        {
	                              $scope.cargandoProductos = true;
	                        },
	                        success: function (resultado, textStatus, jqXHR) 
	                        {
	                              $scope.arrProductos = resultado;
	                              $scope.productoSelected = $scope.arrProductos[0];
	                              $scope.cargandoProductos = false;
	                              $scope.$evalAsync();
	                        }
	
	                  });
	      }
	
    
    $scope.debugMode = false;
    $scope.verbose = false;
    
    
    $scope.MODO_LOCAL = true;
    $scope.urlWS = "";
    $scope.url_DEV = "http://localhost:8999/";
    $scope.url_PROD = "https://wiz.viewdevs.com.ar/";
    
    $scope.year = new Date().getFullYear();
    
    if ($scope.MODO_LOCAL)
    {
          console.log("MODO DEV LOCAL");
          $scope.urlWS = $scope.url_DEV;
          $scope.$evalAsync();
    }
    else
    {
          console.log("MODO PROD");
          $scope.urlWS = $scope.url_PROD;
          $scope.$evalAsync();
    }
    
    
    
    
    
    
    $scope.ponerParametroEnURL = function(nombreParametro, valorParametro, reload)
    {
        console.log("ponerParametroEnURL");
        
        url = window.location.href;
        console.log("URL:" + url);
        
        valorAnterior = $scope.dameValorDelParametroFromURL(nombreParametro);
        posI = url.indexOf(nombreParametro + "=" );
        subURL = url.substr(posI,url.length);
        console.log("subURL:" + subURL);
        posF = posI + subURL.indexOf("&");
        posSignoPregunta = url.indexOf("?");
        
        if(posF == -1)
        {
            posF = url.length;
        }
        if(posF < posI)
        {
            posF = url.length;
        }
        posSignoPregunta = url.indexOf("?");
        if(posSignoPregunta == -1)
        {
            url = url + "?";
        }
        
        console.log("valor anterior: " + valorAnterior + " POSI =" + posI +  " | POSF = " + posF);
        if( valorAnterior != -1 )
        {
            // YA TENGO EL PARAMETRO EN URL:
            preUrl = url.substr(0,(posI-1));
            postUrl = url.substring(posF, url.length);
            url =  preUrl + postUrl;
            console.log("preUrl (" + 0 + "," + (posI-1) + ") :" + preUrl);
            console.log("postUrl (" + posF + "," + url.length + "):" + postUrl);
            console.log("URL CORTADA: " + url);
            
            if(valorParametro != -1)
            {
                url += "&" + nombreParametro + "=" + valorParametro;
            }
        }
        else
        {
            // TODAVIA NO TENGO ESE PARAMETRO EN URL:
            if(valorParametro != -1)
            {
                url +=  "&" + nombreParametro + "=" + valorParametro;
            }
        }
        
        window.history.pushState("object or string", "Title", url);
        if(reload)
        {
          $scope.scrollearSuaveA("carrusel");
          
          setTimeout(function()
          {
                location.reload();
    
          },1500)
        }
    }
    $scope.dameValorDelParametroFromURL = function(nombreParametro)
    {
          var url_string = window.location.href;
          var url = new URL(url_string);
          var parametro = url.searchParams.get(nombreParametro);
    
          if(parametro == null || parametro.length == 0)
          {
                parametro = -1;
          }
          return parametro;
    }
    
    $scope.openNewTab = function(direccion)
    {
          window.open(direccion,'_blank');
    }
    $scope.ir = function(direccion)
    {
          $scope.openNewTab(direccion);
    }
    $scope.redirect = function(direccion)
    {
          $scope.openNewTab(direccion);
    }
    $scope.redireccionamiento = function(direccion)
    {
          window.location.href=direccion;
    }
    $scope.redireccionamientoNewTab = function(direccion)
    {
          $scope.openNewTab(direccion);
    }
    $scope.redirectSameTab = function(direccion)
    {
          window.open(direccion);
    }
    $scope.endsWith = function(valorBuscado, cadena)
    {
          rta = false;
    
          str = "" + cadena;
    
          largoCadena = str.length;
          largoValorBuscado = valorBuscado.length;
    
          posInicial = largoCadena - largoValorBuscado;
          posFinal = largoCadena;
          subStr = str.substring(posInicial , posFinal);
    
          if(JSON.stringify(subStr) === JSON.stringify(valorBuscado))
          {
                rta = true;
          }
    
          console.log("(" + cadena + ").ENDWITH -> buscado: " + valorBuscado +" | encontrado : " + subStr +  " = " + rta);
    
          return rta;
    }
    
    
    
    
    
    
    
    
    
    
    $scope.propsSummernote = {
          height: 180,
          fontSizes: 
          [
                '8', 
                '9', 
                '10',
                '11',
                '12',
                '14',
                '18',
                '24',
                '36',
                '48'
          ],
          popover:
          {
                image: [],
                link: [],
                air: []
          },
          toolbar:
          [
                ['style', ['style']],
                ['font', ['bold', 'italic', 'underline', 'clear']],
                ['fontname', ['fontname']],
                ['color', ['color']],
                ['insert', ['link', 'picture', 'hr']],
                ['view', ['fullscreen', 'codeview']]
          ],
    };
    
    
    $scope.capitalize = function(cadena)
    {
        return cadena.charAt(0).toUpperCase() + cadena.slice(1);
    }
    
    
    //FUNCIONES DE LOGEO:
    $scope.comprobarOperadorLogeado = function(ifNoneRedirectLogin)
    {
        logeado = false;
        token = $scope.getJWT();
        console.log("comprobando operador logeado JWT:" + token);
        console.log("URL::" + $scope.urlWS);
    
        if(token != null && token != "null")
        {
    
            $.ajax(
            {
                url: $scope.urlWS +"/operador/dameOperadorLogeado",
                type:'POST',
                async: false,
                headers: 
                {
                    "Authorization":"Bearer " + token
                },
                beforeSend: function (xhr) 
                {
                    $scope.cargando = true;
                },
                error: function (jqXHR, textStatus, errorThrown) 
                {
        //            window.location.href = $scope.urlLogin; 
                    console.log("debo ir a login");
                   // $scope.redireccionamiento("login")
                },
                success: function (resultado, textStatus, jqXHR) 
                {
                    url = window.location.href;
                    console.log("OPERADOR LOGEADO OK: " + JSON.stringify(resultado) + " -> URL: " +url );
                    if(resultado != null && resultado != "undefined")
                    {
                        $scope.usrLogeado = resultado;
                        $scope.$evalAsync();
    
                        if(url.indexOf("login.html") > -1)
                        {
                            $scope.redireccionamiento("index.html")
                        }
                    }
                    else
                    {
                        if(ifNoneRedirectLogin)
                        {
                            console.log("debo ir a login 2");
                            // $scope.redireccionamiento('login')
                        }
                    }
                }
            });
        }
        else{
            if(ifNoneRedirectLogin)
            {
                console.log("debo ir a login 3");
                $scope.redireccionamiento('login')
            }
        }
        return logeado;
    }
        
    $scope.logearse = function ()
    {
        console.log("logearse:" + $scope.urlWS);
        $.ajax(
                {
                    url: $scope.urlWS + "operador/logearse",
                    type: 'POST',
                    data:
                    {
                            "email": $scope.email,
                            "pass": $scope.pass,
                    },
                    beforeSend: function (xhr) 
                    {
                            $scope.ingresando = true;
                    },
                    error: function (jqXHR, textStatus, errorThrown)
                    {
                            $scope.ingresando = false;
                            $scope.$evalAsync();
    
                            //$scope.snack('ERROR AL INGRESAR!')
                    },
                    success: function (resultado, textStatus, jqXHR) 
                    {
                            if (resultado != null)
                            {
                                console.log("res: " + resultado);
                                $scope.setJWT(resultado);
    
                                // $scope.redireccionamiento('agenda');
                            }
                            else
                            {
                                $scope.ingresando = false;
                                $scope.$evalAsync();
                            }
                    }
    
                });
    
    }
        
    $scope.exit = function()
    {
        $scope.setJWT(null);
        //localStorage.setItem('jwtToken', null);
        $scope.comprobarOperadorLogeado(true);
    }
    $scope.getJWT = function ()
    {
        $scope.jwt = localStorage.getItem('jwtToken');
        console.log("GETTING jwt from localstorage:" + $scope.jwt);;
        $scope.$evalAsync();
    
        return $scope.jwt;
    }
    $scope.setJWT = function (valor)
    {
        $scope.jwt = localStorage.setItem('jwtToken', valor);
        $scope.$evalAsync();
        console.log("SETTING jwt in localstorage:" + valor);;
    }
    
    $(document).ready(function()
    {
          // 1 - LISTENER DE RESIZE EVENT:
          $scope.xl = false;
          $scope.lg = false;
          $scope.md = false;
          $scope.sm = false;
          $scope.xs = true;
    
          console.log("JQuery ready");
          $scope.resize();
    
          $(window).on('resize', function()
          {
                $scope.resize();
          });
    
          document.addEventListener('scroll', function(e)
          {
                var top  = window.pageYOffset || document.documentElement.scrollTop;
                // console.log("SCROLEANDOsss122.."+ JSON.stringify(top))
    
                tengoClasePuesta = $("#cont-menu").hasClass("transparency-menu")
    
                if(top > 550)
                {
                      
                      if( !tengoClasePuesta )
                      {
                            console.log("AGREGANDO TRANSPARENCY A MENU");
                            $("#cont-menu").addClass("transparency-menu");
                      }
                }
                else
                {
                      if( tengoClasePuesta )
                      {
                            console.log("QUITANDO TRANSPARENCY A MENU");
                            $("#cont-menu").removeClass("transparency-menu");
                      }
                }
          }, true);
    });   
    
    $scope.SIZEANT = 0;
    $scope.SIZEX = "LG";
    $scope.resize = function()
    {
          var win = $(window); //this = window
          ancho = win.innerWidth();
          // console.log("RESIZE: " + ancho);
          
          if(ancho < $scope.anchoMinimoWEB)
          {
                console.log("ANCHO MINIMO :" + $scope.anchoMinimoWEB + " | " + ancho);
          }
          
          if (ancho > 1200) 
          {
                $scope.xl = true;
                $scope.lg = false;
                $scope.md = false;
                $scope.sm = false;
                $scope.xs = false;
                $scope.SIZEANT = $scope.SIZEX;
                $scope.SIZEX = "XL";
    
                $scope.$evalAsync();
    
                if($scope.verbose)
                {
                      console.log("ENTRE XL! " + $scope.SIZEX);
                }
          }
          else if(ancho < 1200 && ancho > 992)
          {
                $scope.xl = false;
                $scope.lg = true;
                $scope.md = false;
                $scope.sm = false;
                $scope.xs = false;
                $scope.SIZEANT = $scope.SIZEX;
                $scope.SIZEX = "LG";
    
                $scope.$evalAsync();
    
                if($scope.verbose)
                {
                      console.log("ENTRE LG! " + $scope.SIZEX);
                }
          }
          else if(ancho < 992 && ancho > 768)
          {
                $scope.xl = false;
                $scope.lg = false;
                $scope.md = true;
                $scope.sm = false;
                $scope.xs = false;
                $scope.SIZEANT = $scope.SIZEX;
                $scope.SIZEX = "MD";
    
                $scope.$evalAsync();
    
                if($scope.verbose)
                {
                      console.log("ENTRE MD! "  + $scope.SIZEX);
                }
          }
          else if(ancho < 768 && ancho > 576)
          {
                $scope.xl = false;
                $scope.lg = false;
                $scope.md = false;
                $scope.sm = true;
                $scope.xs = false;
                $scope.SIZEANT = $scope.SIZEX;
                $scope.SIZEX = "SM";
    
                $scope.$evalAsync();
    
                if($scope.verbose)
                {
                      console.log("ENTRE SM! "  + $scope.SIZEX);
                }
          }
          else if ( ancho < 576)
          {
                $scope.xl = false;
                $scope.lg = false;
                $scope.md = false;
                $scope.sm = false;
                $scope.xs = true;
                $scope.SIZEANT = $scope.SIZEX;
                $scope.SIZEX = "XS";
    
                $scope.$evalAsync();
    
                if($scope.verbose)
                {
                      console.log("ENTRE XS! " + $scope.SIZEX);
                }
          }
          
          
          if($scope.xs || $scope.sm || $scope.md)
          {
                $scope.mostrarBusqueda = false;
          }
                
          $scope.ancho = ancho;
          $scope.$evalAsync();
    
          if($scope.SIZEANT != $scope.SIZEX)
          {
                console.log("RESIZE ancho:" + ancho + " | TAMANO: " + $scope.SIZEX );
          }
          
    }
    
    
    $scope.refresca = function()
    {
        var html = $scope.getHTML();
        console.log("html:" + html);
    }
    $scope.setearHTML = function(idSummernote, texto)
    {
        // VERIFICA QUE TENGA UN HASHTAG ADELANTE SINO LO AGREGA:
        if(!idSummernote.startsWith("#"))
        {
            idSummernote = "#" + idSummernote;
        }
    
        console.log("SETEANDO SUMMERNOTE: " + idSummernote + " -> " + texto);
    
        if(texto != null)
        {
            console.log("seteando: " + texto);
    
            $(idSummernote).summernote('code', texto);
            // $('#summernote').summernote('code', texto);
        }
        else
        {
            $(idSummernote).summernote('code', texto);
            // $('#summernote').summernote('code', "");
        }
    }
    $scope.getHTML = function(idSummernote)
    {
            // VERIFICA QUE TENGA UN HASHTAG ADELANTE SINO LO AGREGA:
        if(!idSummernote.startsWith("#"))
        {
            idSummernote = "#" + idSummernote;
        }
    
        var markupStr = $(idSummernote).summernote('code');
    
        // var markupStr = $('#summernote').summernote('code');
        //console.log("VALOR: " + markupStr);
        
        return markupStr;
    }})
;
</script>
<link rel="stylesheet" href="./plantillas/comun.css">
</html>
